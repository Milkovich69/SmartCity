{% extends "base.html" %}

{% block app_content %}
    <link rel="stylesheet" type="text/css" base href="/static/style.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
<div class="container">
    <div class="d-flex justify-content-center h-100">
        <div class="card" style="height: 300px;width: 800px;margin-top: 40px;">
            <div class="card-body" style="width: 800px;">
                <form action="" method="post" style="margin-left: 10px;">
                     {{ form.hidden_tag() }}
                <table>
                    <tr valign="top">
                        <td style="padding-left: 30px;">

                            <div class="d-flex justify-content-center links" style="margin-left: 10px;" color="white">
                            <h1>Участники:</h1>
                            {% for u in users %}
                            <p><input class="check" type="checkbox" id="{{u.id}}" >
                                <b><a href="{{ url_for('user', username=u.username) }}"> {{ u.username }}</a></b></p>
                            {% endfor %}
                            </div>
                            <div class="form-group" style=" padding-top: 10px;">
                                <input type="button" id="b" value="Начислить баллы" class="btn float-right login_btn" onclick="btn()">
                            </div>
                        </td>
                    </tr>
                </table>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
    function btn(){
    var arr = [];
    var res = [];
    var elem;
    var x = new Object();
    var list = document.getElementsByClassName('check');

    for (var i=0; i<list.length; i++){
        if (list[i].id) arr.push(list[i].id);
    }
    for (var i=0; i<list.length; i++){
        elem = document.getElementById(arr[i]);
        if (elem.checked) {res.push('True');}
        else {res.push('False');}
    }
     for (var i=0; i<res.length; i++){
        x[arr[i]] = res[i];
     }
     $.post('{{ url_for('points', id=event.id) }}', x).done(function(response) {
        alert('OK')}).fail(function() {
        alert('ERROR')});

     document.getElementById('b').disabled = true;
    }

</script>

{% endblock %}

